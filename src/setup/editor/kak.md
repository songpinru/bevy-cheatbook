{{#include ../../include/header012.md}}

# Kakoune

如果你是 Kakoune 用户并且你想在这页增加一些内容,请提一个 [GitHub Issue][project::cb::issues].

## Rust 语言支持

你可以一起使用`rust-analyzer`和`kak-lsp`

你要是不想安装官方VSCode插件,只安装RA服务器.

你可以通过`rustup`修改:

```sh
rustup component add rust-analyzer
```

或者你可以自己从git构建安装:

```sh
git clone https://github.com/rust-lang/rust-analyzer
cd rust-analyzer
git checkout release # use the `release` branch instead of `main`
cargo xtask install --server
```

设置 `kak-lsp`最简单的方式是 `plug.kak`.

如果你没有 `plug.kak`, 把下面内容放进 `~/.config/kak/kakrc`:

```kak
evaluate-commands %sh{
    plugins="$kak_config/plugins"
    mkdir -p "$plugins"
    [ ! -e "$plugins/plug.kak" ] && \
        git clone -q https://github.com/andreyorst/plug.kak.git "$plugins/plug.kak"
    printf "%s\n" "source '$plugins/plug.kak/rc/plug.kak'"
}
plug "andreyorst/plug.kak" noload
```

然后设置 `kak-lsp` 的Rust支持:

```kak
plug "kak-lsp/kak-lsp" do %{
    cargo install --force --path .
} config %{
    set global lsp_cmd "kak-lsp -s %val{session}"

    # create a command to let you restart LSP if anything goes wrong / gets glitched
    define-command lsp-restart -docstring 'restart lsp server' %{ lsp-stop; lsp-start }

    # helper command to enable LSP
    define-command -hidden lsp-init %{
        lsp-enable-window
        # preferences:
        set window lsp_auto_highlight_references true
        lsp-auto-signature-help-enable
        # keybind: use "," to get a menu of available LSP commands
        map global normal "," ": enter-user-mode lsp<ret>" -docstring "LSP mode"
    }

    hook global KakEnd .* lsp-exit

    # autoenable LSP when opening Rust files
    hook global WinSetOption filetype=rust %{
        lsp-init
    }
}
# formatting settings for Rust files
hook global BufSetOption filetype=rust %{
    set buffer tabstop 4
    set buffer indentwidth 4
    set buffer formatcmd 'rustfmt'
    set buffer autowrap_column 100
    expandtab
}
```

把下面内容放在 `~/.config/kak-lsp/kak-lsp.toml` 来使用 `rust-analyzer`:

```toml
[server]
# Shut down the `rust-analyzer` process after a period of inactivity
timeout = 900

[language.rust]
filetypes = ["rust"]
roots = ["Cargo.toml"]
command = "rust-analyzer"
settings_section = "rust-analyzer"

[language.rust.settings.rust-analyzer]
# Proc Macro support is important for Bevy projects
procMacro.enable = true
# disable hover actions, can be laggy on complex projects like Bevy
hoverActions.enable = false
# use the data generated by `cargo check`; disable if it is too slow for you
cargo.loadOutDirsFromCheck = true
```

